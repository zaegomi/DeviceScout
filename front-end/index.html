<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeviceScout - Network Security Made Simple</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5dc;
            min-height: 100vh;
        }

        .app-container {
            min-height: 100vh;
            background: #f5f5dc;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background: #f5f5dc;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-image {
            width: 160px;
            height: 160px;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.2);
            transition: transform 0.3s ease;
        }

        .logo-image:hover {
            transform: scale(1.05);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a202c;
        }

        .logo-subtitle {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .nav-button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #c1839f 0%, #a0647a 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(161, 100, 122, 0.3);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(161, 100, 122, 0.4);
        }

        .nav-button.active {
            background: linear-gradient(135deg, #e53e3e 0%, #f56565 100%);
            box-shadow: 0 6px 20px rgba(229, 62, 62, 0.4);
        }

        .main-content {
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .start-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .scan-circle {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c1839f 0%, #a0647a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 15px 35px rgba(161, 100, 122, 0.3);
        }

        .scan-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(161, 100, 122, 0.4);
        }

        .scan-text {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: white;
            border: 3px solid #2d3748;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .card-content {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 15px;
        }

        .metric-value {
            font-size: 3rem;
            font-weight: 700;
            color: #e53e3e;
        }

        .metric-label {
            font-size: 1.1rem;
            color: #64748b;
            font-weight: 500;
        }

        .device-container {
            background: white;
            border: 3px solid #2d3748;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .device-title {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            text-align: center;
            margin-bottom: 30px;
        }

        .device-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .device-item {
            background: #f8f9fa;
            border: 2px solid #2d3748;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .device-item:hover {
            background: #e9ecef;
            transform: translateX(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: #e53e3e;
        }

        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .device-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
        }

        .security-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .security-critical {
            background: #fee;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .security-high {
            background: #fef5e7;
            color: #d69e2e;
            border: 1px solid #f6e05e;
        }

        .security-medium {
            background: #f0fff4;
            color: #38a169;
            border: 1px solid #9ae6b4;
        }

        .security-low {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #cbd5e0;
        }

        .device-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            color: #64748b;
            font-size: 0.9rem;
        }

        .device-info {
            display: flex;
            justify-content: space-between;
        }

        .security-container {
            background: white;
            border: 3px solid #2d3748;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .security-title {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 40px;
            text-align: center;
        }

        .security-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .security-score-card {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
        }

        .security-score {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .score-excellent { color: #38a169; }
        .score-good { color: #38a169; }
        .score-fair { color: #d69e2e; }
        .score-poor { color: #e53e3e; }
        .score-critical { color: #c53030; }

        .security-status {
            font-size: 1.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .vulnerability-section {
            margin-top: 40px;
        }

        .vulnerability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .vulnerability-card {
            background: #fff5f5;
            border: 2px solid #fed7d7;
            border-radius: 15px;
            padding: 25px;
        }

        .vulnerability-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .vulnerability-list {
            list-style: none;
            padding: 0;
        }

        .vulnerability-item {
            background: white;
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #e53e3e;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .recommendation-card {
            background: #f0fff4;
            border: 2px solid #9ae6b4;
            border-radius: 15px;
            padding: 25px;
        }

        .recommendation-item {
            background: white;
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #38a169;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
        }

        .stat-label {
            color: #64748b;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .data-status {
            background: #f0f9ff;
            border: 2px solid #bae6fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .data-status-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #0369a1;
            font-weight: 500;
        }

        .refresh-button {
            padding: 8px 16px;
            background: linear-gradient(135deg, #0369a1, #0284c7);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(3, 105, 161, 0.3);
        }

        /* Export/Report Styles */
        .export-section {
            background: #fff8e1;
            border: 2px solid #ffcc02;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .export-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .export-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .export-button {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-pdf {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
        }

        .export-csv {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
        }

        .export-print {
            background: linear-gradient(135deg, #7c3aed, #8b5cf6);
            color: white;
        }

        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .export-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .export-description {
            color: #64748b;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Print-specific styles */
        @media print {
            .header, .nav-buttons, .export-section, .data-status {
                display: none !important;
            }
            
            .main-content {
                padding: 0;
                max-width: none;
            }
            
            .page {
                display: block !important;
            }
            
            .dashboard-grid, .security-overview, .vulnerability-grid {
                break-inside: avoid;
            }
        }

        /* Device Detail Page Styles */
        .device-detail-container {
            background: white;
            border: 3px solid #2d3748;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .device-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .device-detail-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
        }

        .back-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #c1839f 0%, #a0647a 100%);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(161, 100, 122, 0.4);
        }

        .device-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .device-info-section {
            background: #f8f9fa;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
            flex: 1;
        }

        .info-value {
            color: #2d3748;
            font-weight: 500;
            flex: 2;
            text-align: right;
        }

        .security-detail-section {
            grid-column: 1 / -1;
            background: #fff5f5;
            border: 2px solid #fed7d7;
            border-radius: 15px;
            padding: 25px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .loading-animation {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #c1839f, #e53e3e);
            transition: width 0.3s ease;
        }

        .scan-progress {
            text-align: center;
            margin-top: 20px;
        }

        .scan-status {
            font-size: 1.1rem;
            color: #4a5568;
            margin-bottom: 10px;
        }

        /* Enhanced Security Display Styles */
        .ssl-info-section {
            background: #f0f9ff;
            border: 2px solid #bae6fd;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .ssl-info-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ssl-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
        }

        .ssl-valid {
            color: #059669;
            font-weight: 600;
        }

        .ssl-warning {
            color: #d97706;
            font-weight: 600;
        }

        .ssl-error {
            color: #dc2626;
            font-weight: 600;
        }

        .credential-section {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .credential-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .credential-vulnerable {
            background: #fee2e2;
            border: 2px solid #fca5a5;
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
        }

        .credential-item {
            color: #991b1b;
            font-weight: 600;
            font-family: monospace;
        }

        .security-metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .security-metric-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .metric-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
        }

        .metric-description {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 5px;
        }

        .enhanced-port-info {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
        }

        .port-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .port-title {
            font-weight: 600;
            color: #374151;
        }

        .risk-indicator {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .risk-high {
            background: #fef3c7;
            color: #92400e;
        }

        .risk-medium {
            background: #d1fae5;
            color: #065f46;
        }

        .risk-low {
            background: #f3f4f6;
            color: #374151;
        }

        @media (max-width: 900px) {
            .header {
                flex-direction: column;
                gap: 20px;
                padding: 20px;
            }
            
            .nav-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .scan-circle {
                width: 250px;
                height: 250px;
            }
            
            .scan-text {
                font-size: 1.5rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .device-details {
                grid-template-columns: 1fr;
            }

            .security-overview {
                grid-template-columns: 1fr;
            }

            .device-detail-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function DeviceScout() {
            const [currentPage, setCurrentPage] = useState('start');
            const [isScanning, setIsScanning] = useState(false);
            const [scanProgress, setScanProgress] = useState(0);
            const [scanStatus, setScanStatus] = useState('');
            const [deviceCount, setDeviceCount] = useState(0);
            const [devices, setDevices] = useState([]);
            const [networkSecurity, setNetworkSecurity] = useState(null);
            const [vulnerabilityStats, setVulnerabilityStats] = useState(null);
            const [selectedDevice, setSelectedDevice] = useState(null);

            // Export and reporting functions
            const generateCSVReport = () => {
                if (devices.length === 0) {
                    alert('No device data available to export. Please run a scan first.');
                    return;
                }

                // CSV Header
                const headers = [
                    'Device Name',
                    'IP Address', 
                    'MAC Address',
                    'Vendor',
                    'Operating System',
                    'Security Level',
                    'Risk Score',
                    'Open Ports',
                    'Vulnerabilities',
                    'Status',
                    'Last Seen'
                ];

                // CSV Data
                const csvData = devices.map(device => [
                    device.hostname !== 'Unknown' ? device.hostname : device.ip,
                    device.ip,
                    device.mac,
                    device.vendor,
                    device.osNmap,
                    device.security?.securityLevel || 'Unknown',
                    device.security?.riskScore || 0,
                    device.openPorts?.length || 0,
                    device.security?.vulnerabilities.join('; ') || 'None',
                    device.state,
                    new Date(device.lastSeen).toLocaleString()
                ]);

                // Convert to CSV format
                const csvContent = [headers, ...csvData]
                    .map(row => row.map(field => `"${field}"`).join(','))
                    .join('\n');

                // Download CSV
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `DeviceScout_Security_Report_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                console.log('📊 CSV report exported successfully');
            };

            const generatePDFReport = async () => {
                if (devices.length === 0) {
                    alert('No device data available to export. Please run a scan first.');
                    return;
                }

                try {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();
                    
                    // Report Header
                    pdf.setFontSize(20);
                    pdf.setTextColor(45, 55, 72);
                    pdf.text('DeviceScout Security Report', 20, 30);
                    
                    pdf.setFontSize(12);
                    pdf.setTextColor(100, 116, 139);
                    pdf.text(`Generated: ${new Date().toLocaleString()}`, 20, 40);
                    pdf.text(`Scan Date: ${formatTimestamp(getScanTimestamp())}`, 20, 50);

                    // Executive Summary
                    pdf.setFontSize(16);
                    pdf.setTextColor(45, 55, 72);
                    pdf.text('Executive Summary', 20, 70);
                    
                    pdf.setFontSize(11);
                    pdf.setTextColor(74, 85, 104);
                    let yPos = 85;
                    
                    pdf.text(`• Total Devices Discovered: ${deviceCount}`, 25, yPos);
                    yPos += 10;
                    pdf.text(`• Network Security Score: ${networkSecurity?.score || 0}/100 (${networkSecurity?.level || 'Unknown'})`, 25, yPos);
                    yPos += 10;
                    pdf.text(`• High Risk Devices: ${networkSecurity?.highRiskDevices || 0}`, 25, yPos);
                    yPos += 10;
                    pdf.text(`• Critical Vulnerabilities: ${networkSecurity?.criticalVulnerabilities || 0}`, 25, yPos);
                    yPos += 20;

                    // Device Details Table
                    pdf.setFontSize(14);
                    pdf.setTextColor(45, 55, 72);
                    pdf.text('Device Security Analysis', 20, yPos);
                    yPos += 15;

                    // Table headers
                    pdf.setFontSize(9);
                    pdf.setTextColor(74, 85, 104);
                    pdf.text('Device', 20, yPos);
                    pdf.text('IP Address', 70, yPos);
                    pdf.text('Vendor', 110, yPos);
                    pdf.text('Risk Level', 150, yPos);
                    pdf.text('Score', 180, yPos);
                    yPos += 8;

                    // Table data
                    devices.forEach((device, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 30;
                        }

                        const deviceName = device.hostname !== 'Unknown' ? device.hostname : device.ip;
                        const riskLevel = device.security?.securityLevel || 'Unknown';
                        const riskScore = device.security?.riskScore || 0;

                        // Color code risk levels
                        if (riskLevel === 'Critical') pdf.setTextColor(197, 48, 48);
                        else if (riskLevel === 'High') pdf.setTextColor(214, 158, 46);
                        else if (riskLevel === 'Medium') pdf.setTextColor(56, 161, 105);
                        else pdf.setTextColor(74, 85, 104);

                        pdf.text(deviceName.substring(0, 20), 20, yPos);
                        pdf.text(device.ip, 70, yPos);
                        pdf.text(device.vendor.substring(0, 15), 110, yPos);
                        pdf.text(riskLevel, 150, yPos);
                        pdf.text(`${riskScore}/100`, 180, yPos);
                        yPos += 8;
                    });

                    // Recommendations section
                    if (yPos > 220) {
                        pdf.addPage();
                        yPos = 30;
                    } else {
                        yPos += 15;
                    }

                    pdf.setFontSize(14);
                    pdf.setTextColor(45, 55, 72);
                    pdf.text('Security Recommendations', 20, yPos);
                    yPos += 15;

                    pdf.setFontSize(10);
                    pdf.setTextColor(74, 85, 104);
                    
                    const recommendations = [
                        'Regularly update firmware on all network devices',
                        'Change default passwords on routers and IoT devices',
                        'Enable WPA3 encryption on wireless networks',
                        'Implement network segmentation for IoT devices',
                        'Monitor network traffic for suspicious activity',
                        'Disable unnecessary services and ports',
                        'Use strong, unique passwords for all devices',
                        'Enable automatic security updates where possible'
                    ];

                    recommendations.forEach((rec, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 30;
                        }
                        pdf.text(`• ${rec}`, 25, yPos);
                        yPos += 10;
                    });

                    // Footer
                    const pageCount = pdf.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        pdf.setPage(i);
                        pdf.setFontSize(8);
                        pdf.setTextColor(156, 163, 175);
                        pdf.text(`DeviceScout Security Report - Page ${i} of ${pageCount}`, 20, 285);
                        pdf.text('Generated by DeviceScout - Network Security Made Simple', 20, 292);
                    }

                    // Save PDF
                    pdf.save(`DeviceScout_Security_Report_${new Date().toISOString().split('T')[0]}.pdf`);
                    console.log('📄 PDF report generated successfully');

                } catch (error) {
                    console.error('❌ PDF generation failed:', error);
                    alert('Failed to generate PDF report. Please try again.');
                }
            };

            const printReport = () => {
                if (devices.length === 0) {
                    alert('No device data available to print. Please run a scan first.');
                    return;
                }

                // Store current page
                const currentPage = currentPage;
                
                // Switch to dashboard for printing
                setCurrentPage('dashboard');
                
                // Print after short delay to ensure page renders
                setTimeout(() => {
                    window.print();
                    // Restore original page after print dialog
                    setTimeout(() => setCurrentPage(currentPage), 1000);
                }, 500);

                console.log('🖨️ Print dialog opened');
            };

            // Load saved data on component mount
            useEffect(() => {
                loadSavedData();
            }, []);

            // Save data to localStorage whenever it changes
            useEffect(() => {
                if (devices.length > 0) {
                    saveScanData();
                }
            }, [devices, networkSecurity, vulnerabilityStats, deviceCount]);

            const saveScanData = () => {
                const scanData = {
                    deviceCount,
                    devices,
                    networkSecurity,
                    vulnerabilityStats,
                    scanTimestamp: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem('deviceScoutScanData', JSON.stringify(scanData));
                    console.log('💾 Scan data saved to localStorage');
                } catch (error) {
                    console.error('❌ Failed to save scan data:', error);
                }
            };

            const loadSavedData = () => {
                try {
                    const savedData = localStorage.getItem('deviceScoutScanData');
                    if (savedData) {
                        const scanData = JSON.parse(savedData);
                        
                        setDeviceCount(scanData.deviceCount || 0);
                        setDevices(scanData.devices || []);
                        setNetworkSecurity(scanData.networkSecurity || null);
                        setVulnerabilityStats(scanData.vulnerabilityStats || null);
                        
                        // If we have saved data, go to dashboard instead of start page
                        if (scanData.devices && scanData.devices.length > 0) {
                            setCurrentPage('dashboard');
                            console.log('📂 Loaded saved scan data from localStorage');
                            console.log(`🔄 Restored ${scanData.devices.length} devices from ${scanData.scanTimestamp}`);
                        }
                    }
                } catch (error) {
                    console.error('❌ Failed to load saved data:', error);
                }
            };

            const clearScanData = () => {
                try {
                    localStorage.removeItem('deviceScoutScanData');
                    console.log('🗑️ Cleared saved scan data');
                } catch (error) {
                    console.error('❌ Failed to clear saved data:', error);
                }
                
                // Reset all state
                setDeviceCount(0);
                setDevices([]);
                setNetworkSecurity(null);
                setVulnerabilityStats(null);
                setSelectedDevice(null);
                setScanProgress(0);
                setScanStatus('');
            };

            const handleScan = async () => {
                // Clear any existing data before starting new scan
                clearScanData();
                
                setIsScanning(true);
                setScanProgress(0);
                setScanStatus('Initializing scan...');
                
                try {
                    console.log('🔍 Starting enhanced network security scan...');
                    
                    // Simulate progress updates
                    const progressInterval = setInterval(() => {
                        setScanProgress(prev => {
                            const newProgress = Math.min(prev + Math.random() * 15, 90);
                            if (newProgress < 30) {
                                setScanStatus('Discovering devices...');
                            } else if (newProgress < 60) {
                                setScanStatus('Analyzing security vulnerabilities...');
                            } else if (newProgress < 90) {
                                setScanStatus('Checking for default passwords and open ports...');
                            }
                            return newProgress;
                        });
                    }, 1000);
                    
                    // Call enhanced backend API
                    const response = await fetch('http://localhost:3001/api/scan');
                    const data = await response.json();
                    
                    clearInterval(progressInterval);
                    setScanProgress(100);
                    setScanStatus('Scan completed!');
                    
                    if (data.success) {
                        console.log('✅ Enhanced scan completed:', data);
                        
                        // Update state with enhanced data
                        setDeviceCount(data.deviceCount);
                        setDevices(data.devices);
                        setNetworkSecurity(data.networkSecurity);
                        setVulnerabilityStats(data.vulnerabilityStats);
                        
                        console.log(`📱 Found ${data.deviceCount} devices`);
                        console.log(`🔒 Network Security Score: ${data.networkSecurity.score}/100`);
                        console.log(`⚠️ High Risk Devices: ${data.networkSecurity.highRiskDevices}`);
                    } else {
                        console.error('❌ Enhanced scan failed:', data.error);
                        alert('Enhanced scan failed: ' + data.error);
                    }
                } catch (error) {
                    console.error('❌ Network error:', error);
                    alert('Could not connect to backend. Make sure the server is running on http://localhost:3001');
                } finally {
                    setIsScanning(false);
                    setCurrentPage('dashboard');
                }
            };

            const navigateToPage = (page) => {
                setCurrentPage(page);
                // Clear selected device when navigating away from device detail
                if (page !== 'device-detail') {
                    setSelectedDevice(null);
                }
            };

            const viewDeviceDetail = (device) => {
                setSelectedDevice(device);
                setCurrentPage('device-detail');
            };

            const startNewScan = () => {
                // Clear all data and go to start page
                clearScanData();
                setCurrentPage('start');
            };

            const getScanTimestamp = () => {
                try {
                    const savedData = localStorage.getItem('deviceScoutScanData');
                    if (savedData) {
                        const scanData = JSON.parse(savedData);
                        return scanData.scanTimestamp;
                    }
                } catch (error) {
                    console.error('❌ Failed to get scan timestamp:', error);
                }
                return null;
            };

            const formatTimestamp = (timestamp) => {
                if (!timestamp) return 'Unknown';
                const date = new Date(timestamp);
                const now = new Date();
                const diffMinutes = Math.floor((now - date) / (1000 * 60));
                
                if (diffMinutes < 1) return 'Just now';
                if (diffMinutes < 60) return `${diffMinutes} minute${diffMinutes > 1 ? 's' : ''} ago`;
                if (diffMinutes < 1440) return `${Math.floor(diffMinutes / 60)} hour${Math.floor(diffMinutes / 60) > 1 ? 's' : ''} ago`;
                return date.toLocaleString();
            };

            const getSecurityScoreClass = (score) => {
                if (score >= 90) return 'score-excellent';
                if (score >= 70) return 'score-good';
                if (score >= 50) return 'score-fair';
                if (score >= 30) return 'score-poor';
                return 'score-critical';
            };

            const getSecurityStatusText = (score) => {
                if (score >= 90) return 'Excellent';
                if (score >= 70) return 'Good';
                if (score >= 50) return 'Fair';
                if (score >= 30) return 'Poor';
                return 'Critical';
            };

            return (
                <div className="app-container">
                    <header className="header">
                        <div className="logo-section">
                            <img src="logo.png" alt="DeviceScout Logo" className="logo-image" />
                            <div className="logo-text">
                                <div className="logo-title">DeviceScout</div>
                                <div className="logo-subtitle">Network Security Made Simple</div>
                            </div>
                        </div>
                        
                        {currentPage !== 'start' && (
                            <nav className="nav-buttons">
                                <button 
                                    className={`nav-button ${currentPage === 'dashboard' ? 'active' : ''}`}
                                    onClick={() => navigateToPage('dashboard')}
                                >
                                    Dashboard
                                </button>
                                <button 
                                    className={`nav-button ${currentPage === 'devices' ? 'active' : ''}`}
                                    onClick={() => navigateToPage('devices')}
                                >
                                    Devices
                                </button>
                                <button 
                                    className={`nav-button ${currentPage === 'security' ? 'active' : ''}`}
                                    onClick={() => navigateToPage('security')}
                                >
                                    Security
                                </button>
                                <button 
                                    className="nav-button"
                                    onClick={startNewScan}
                                >
                                    New Scan
                                </button>
                            </nav>
                        )}
                    </header>

                    <main className="main-content">
                        {/* Start Page */}
                        <div className={`page ${currentPage === 'start' ? 'active' : ''}`}>
                            <div className="start-page">
                                <div className="scan-circle" onClick={handleScan}>
                                    <div className="scan-text">
                                        {isScanning ? (
                                            <>
                                                <div className="loading-animation"></div>
                                                <div style={{marginTop: '10px', fontSize: '1.2rem'}}>Scanning...</div>
                                            </>
                                        ) : (
                                            'Click to Scan'
                                        )}
                                    </div>
                                </div>
                                
                                {isScanning && (
                                    <div className="scan-progress">
                                        <div className="scan-status">{scanStatus}</div>
                                        <div className="progress-bar">
                                            <div 
                                                className="progress-fill" 
                                                style={{width: `${scanProgress}%`}}
                                            ></div>
                                        </div>
                                        <div style={{fontSize: '0.9rem', color: '#64748b'}}>
                                            {Math.round(scanProgress)}% Complete
                                        </div>
                                    </div>
                                )}
                                
                                {!isScanning && (
                                    <p style={{fontSize: '1.2rem', color: '#64748b', maxWidth: '600px'}}>
                                        Welcome to DeviceScout! Click the button above to start an enhanced security scan 
                                        that will discover devices, check for vulnerabilities, default passwords, and security risks.
                                    </p>
                                )}
                            </div>
                        </div>

                        {/* Dashboard Page */}
                        <div className={`page ${currentPage === 'dashboard' ? 'active' : ''}`}>
                            {/* Export/Report Section */}
                            {devices.length > 0 && (
                                <div className="export-section">
                                    <div className="export-header">
                                        <div className="export-title">
                                            <span>📊</span>
                                            Export & Reports
                                        </div>
                                        <div className="export-buttons">
                                            <button 
                                                className="export-button export-pdf"
                                                onClick={generatePDFReport}
                                            >
                                                📄 PDF Report
                                            </button>
                                            <button 
                                                className="export-button export-csv"
                                                onClick={generateCSVReport}
                                            >
                                                📊 CSV Data
                                            </button>
                                            <button 
                                                className="export-button export-print"
                                                onClick={printReport}
                                            >
                                                🖨️ Print
                                            </button>
                                        </div>
                                    </div>
                                    <div className="export-description">
                                        Export your security scan results for sharing, reporting, or record keeping. 
                                        PDF includes executive summary and recommendations.
                                    </div>
                                </div>
                            )}

                            {/* Data Status Indicator */}
                            {devices.length > 0 && (
                                <div className="data-status">
                                    <div className="data-status-info">
                                        <div>📡</div>
                                        <div>
                                            <strong>Last Scan:</strong> {formatTimestamp(getScanTimestamp())}
                                        </div>
                                    </div>
                                    <button 
                                        className="refresh-button"
                                        onClick={startNewScan}
                                    >
                                        🔄 Refresh Scan
                                    </button>
                                </div>
                            )}

                            <div className="dashboard-grid">
                                <div className="dashboard-card">
                                    <h2 className="card-title">Total Devices</h2>
                                    <div className="card-content">
                                        <div className="metric-value">{deviceCount}</div>
                                        <div className="metric-label">Connected Devices</div>
                                        <div style={{fontSize: '0.9rem', color: '#38a169', marginTop: '10px'}}>
                                            ✓ All devices discovered
                                        </div>
                                    </div>
                                </div>

                                <div className="dashboard-card">
                                    <h2 className="card-title">Network Security</h2>
                                    <div className="card-content">
                                        <div className={`metric-value ${networkSecurity ? getSecurityScoreClass(networkSecurity.score) : ''}`}>
                                            {networkSecurity ? `${networkSecurity.score}/100` : '0/100'}
                                        </div>
                                        <div className="metric-label">Security Score</div>
                                        <div style={{fontSize: '0.9rem', marginTop: '10px'}}>
                                            {networkSecurity ? getSecurityStatusText(networkSecurity.score) : 'No data'}
                                        </div>
                                    </div>
                                </div>

                                <div className="dashboard-card">
                                    <h2 className="card-title">Risk Assessment</h2>
                                    <div className="card-content">
                                        <div className="metric-value" style={{color: '#e53e3e'}}>
                                            {networkSecurity ? networkSecurity.highRiskDevices : 0}
                                        </div>
                                        <div className="metric-label">High Risk Devices</div>
                                        <div style={{fontSize: '0.9rem', color: '#e53e3e', marginTop: '10px'}}>
                                            {networkSecurity && networkSecurity.criticalVulnerabilities > 0 
                                                ? `⚠ ${networkSecurity.criticalVulnerabilities} Critical Issues` 
                                                : '✓ No Critical Issues'}
                                        </div>
                                    </div>
                                </div>

                                <div className="dashboard-card">
                                    <h2 className="card-title">Vulnerability Stats</h2>
                                    <div className="card-content">
                                        {vulnerabilityStats ? (
                                            <div style={{fontSize: '1rem', color: '#2d3748', lineHeight: '1.6', textAlign: 'left'}}>
                                                <div>🔒 Critical: {vulnerabilityStats.securityLevels.Critical}</div>
                                                <div>⚠️ High: {vulnerabilityStats.securityLevels.High}</div>
                                                <div>📊 Medium: {vulnerabilityStats.securityLevels.Medium}</div>
                                                <div>✅ Low: {vulnerabilityStats.securityLevels.Low}</div>
                                                <div style={{marginTop: '10px', fontWeight: '600'}}>
                                                    Avg Risk: {vulnerabilityStats.averageRiskScore}/100
                                                </div>
                                            </div>
                                        ) : (
                                            <div>Run a scan to see vulnerability statistics</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Devices Page */}
                        <div className={`page ${currentPage === 'devices' ? 'active' : ''}`}>
                            <div className="device-container">
                                {/* Export Section for Devices */}
                                {devices.length > 0 && (
                                    <div className="export-section">
                                        <div className="export-header">
                                            <div className="export-title">
                                                <span>📋</span>
                                                Device List Export
                                            </div>
                                            <div className="export-buttons">
                                                <button 
                                                    className="export-button export-csv"
                                                    onClick={generateCSVReport}
                                                >
                                                    📊 Export Device List
                                                </button>
                                            </div>
                                        </div>
                                        <div className="export-description">
                                            Download complete device inventory with security details in CSV format.
                                        </div>
                                    </div>
                                )}

                                {/* Data Status Indicator */}
                                {devices.length > 0 && (
                                    <div className="data-status">
                                        <div className="data-status-info">
                                            <div>🔍</div>
                                            <div>
                                                <strong>Scan Results:</strong> {devices.length} devices found {formatTimestamp(getScanTimestamp())}
                                            </div>
                                        </div>
                                        <button 
                                            className="refresh-button"
                                            onClick={startNewScan}
                                        >
                                            🔄 New Scan
                                        </button>
                                    </div>
                                )}

                                <h2 className="device-title">Device Security Analysis</h2>
                                <div className="device-list">
                                    {devices.length > 0 ? (
                                        devices.map((device, index) => (
                                            <div 
                                                key={index} 
                                                className="device-item"
                                                onClick={() => viewDeviceDetail(device)}
                                            >
                                                <div className="device-header">
                                                    <div className="device-name">
                                                        {device.hostname !== 'Unknown' ? device.hostname : device.ip}
                                                    </div>
                                                    {device.security && (
                                                        <div className={`security-badge security-${device.security.securityLevel.toLowerCase()}`}>
                                                            {device.security.securityLevel}
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="device-details">
                                                    <div className="device-info">
                                                        <span>IP Address:</span>
                                                        <span>{device.ip}</span>
                                                    </div>
                                                    <div className="device-info">
                                                        <span>Vendor:</span>
                                                        <span>{device.vendor}</span>
                                                    </div>
                                                    <div className="device-info">
                                                        <span>Open Ports:</span>
                                                        <span>{device.openPorts ? device.openPorts.length : 0}</span>
                                                    </div>
                                                    <div className="device-info">
                                                        <span>Risk Score:</span>
                                                        <span>{device.security ? `${device.security.riskScore}/100` : 'N/A'}</span>
                                                    </div>
                                                </div>
                                                {device.security && device.security.vulnerabilities.length > 0 && (
                                                    <div style={{marginTop: '15px', fontSize: '0.9rem', color: '#e53e3e'}}>
                                                        <strong>Key Issues:</strong> {device.security.vulnerabilities.slice(0, 2).join(', ')}
                                                        {device.security.vulnerabilities.length > 2 && '...'}
                                                    </div>
                                                )}
                                                <div style={{marginTop: '10px', fontSize: '0.8rem', color: '#64748b', fontStyle: 'italic'}}>
                                                    Click for detailed analysis →
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <div className="device-item">
                                            <div className="device-name">No devices found</div>
                                            <div style={{color: '#64748b', marginTop: '10px'}}>
                                                Run an enhanced security scan to discover devices and assess vulnerabilities.
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Device Detail Page */}
                        <div className={`page ${currentPage === 'device-detail' ? 'active' : ''}`}>
                            {selectedDevice && (
                                <div className="device-detail-container">
                                    <div className="device-detail-header">
                                        <div>
                                            <h1 className="device-detail-title">
                                                {selectedDevice.hostname !== 'Unknown' ? selectedDevice.hostname : selectedDevice.ip}
                                            </h1>
                                            <div style={{fontSize: '1.2rem', color: '#64748b', marginTop: '5px'}}>
                                                {selectedDevice.vendor} • {selectedDevice.ip}
                                            </div>
                                        </div>
                                        <button 
                                            className="back-button"
                                            onClick={() => navigateToPage('devices')}
                                        >
                                            ← Back to Devices
                                        </button>
                                    </div>

                                    <div className="device-detail-grid">
                                        {/* Basic Information */}
                                        <div className="device-info-section">
                                            <h3 className="section-title">Basic Information</h3>
                                            <div className="info-row">
                                                <span className="info-label">IP Address:</span>
                                                <span className="info-value">{selectedDevice.ip}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Hostname:</span>
                                                <span className="info-value">{selectedDevice.hostname}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">MAC Address:</span>
                                                <span className="info-value">{selectedDevice.mac}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Vendor:</span>
                                                <span className="info-value">{selectedDevice.vendor}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Operating System:</span>
                                                <span className="info-value">{selectedDevice.osNmap}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Device Status:</span>
                                                <span className="info-value" style={{color: selectedDevice.state === 'up' ? '#38a169' : '#e53e3e'}}>
                                                    {selectedDevice.state.toUpperCase()}
                                                </span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Last Seen:</span>
                                                <span className="info-value">
                                                    {new Date(selectedDevice.lastSeen).toLocaleString()}
                                                </span>
                                            </div>
                                        </div>

                                        {/* Network Information */}
                                        <div className="device-info-section">
                                            <h3 className="section-title">Network Information</h3>
                                            <div className="info-row">
                                                <span className="info-label">Open Ports:</span>
                                                <span className="info-value">{selectedDevice.openPorts ? selectedDevice.openPorts.length : 0}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Security Level:</span>
                                                <span className="info-value">
                                                    <span className={`security-badge security-${selectedDevice.security?.securityLevel.toLowerCase()}`}>
                                                        {selectedDevice.security?.securityLevel || 'Unknown'}
                                                    </span>
                                                </span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Risk Score:</span>
                                                <span className="info-value" style={{fontWeight: '700', fontSize: '1.2rem'}}>
                                                    {selectedDevice.security?.riskScore || 0}/100
                                                </span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Vulnerabilities Found:</span>
                                                <span className="info-value" style={{color: '#e53e3e'}}>
                                                    {selectedDevice.security?.vulnerabilities.length || 0}
                                                </span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">Recommendations:</span>
                                                <span className="info-value" style={{color: '#38a169'}}>
                                                    {selectedDevice.security?.recommendations.length || 0}
                                                </span>
                                            </div>
                                        </div>

                                        {/* Security Assessment */}
                                        {selectedDevice.security && (
                                            <div className="security-detail-section">
                                                <h3 className="section-title">Security Assessment</h3>
                                                
                                                {selectedDevice.security.vulnerabilities.length > 0 && (
                                                    <div>
                                                        <h4 style={{color: '#e53e3e', fontSize: '1.3rem', marginBottom: '15px'}}>
                                                            🚨 Security Vulnerabilities
                                                        </h4>
                                                        <ul className="vulnerability-list">
                                                            {selectedDevice.security.vulnerabilities.map((vuln, index) => (
                                                                <li key={index} className="vulnerability-item">
                                                                    {vuln}
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                )}

                                                {selectedDevice.security.recommendations.length > 0 && (
                                                    <div style={{marginTop: '20px'}}>
                                                        <h4 style={{color: '#38a169', fontSize: '1.3rem', marginBottom: '15px'}}>
                                                            ✅ Security Recommendations
                                                        </h4>
                                                        <ul className="vulnerability-list">
                                                            {selectedDevice.security.recommendations.map((rec, index) => (
                                                                <li key={index} className="recommendation-item">
                                                                    {rec}
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    {/* Open Ports Section */}
                                    {selectedDevice.openPorts && selectedDevice.openPorts.length > 0 && (
                                        <div style={{marginTop: '30px'}}>
                                            <h3 className="section-title">Open Ports & Security Analysis</h3>
                                            
                                            {selectedDevice.openPorts.map((port, index) => (
                                                <div key={index} className="enhanced-port-info">
                                                    <div className="port-header">
                                                        <div className="port-title">
                                                            Port {port.port} - {port.service || 'Unknown Service'}
                                                        </div>
                                                        <div className={`risk-indicator risk-${port.risk || 'low'}`}>
                                                            {(port.risk || 'low').toUpperCase()} RISK
                                                        </div>
                                                    </div>
                                                    
                                                    {port.description && (
                                                        <div style={{color: '#6b7280', fontSize: '0.9rem', marginBottom: '10px'}}>
                                                            {port.description}
                                                        </div>
                                                    )}

                                                    {/* SSL Certificate Information */}
                                                    {port.sslInfo && (
                                                        <div className="ssl-info-section">
                                                            <div className="ssl-info-title">
                                                                🔒 SSL/TLS Certificate Analysis
                                                            </div>
                                                            
                                                            {port.sslInfo.hasSSL ? (
                                                                <div>
                                                                    <div className="ssl-status">
                                                                        <span className={port.sslInfo.expired ? 'ssl-error' : port.sslInfo.daysUntilExpiry <= 30 ? 'ssl-warning' : 'ssl-valid'}>
                                                                            {port.sslInfo.expired ? '❌ Certificate Expired' : 
                                                                             port.sslInfo.daysUntilExpiry <= 30 ? `⚠️ Expires in ${port.sslInfo.daysUntilExpiry} days` :
                                                                             `✅ Valid for ${port.sslInfo.daysUntilExpiry} days`}
                                                                        </span>
                                                                    </div>
                                                                    
                                                                    <div style={{fontSize: '0.9rem', color: '#374151', marginTop: '8px'}}>
                                                                        <div><strong>Issued to:</strong> {port.sslInfo.subject?.CN || 'Unknown'}</div>
                                                                        <div><strong>Issued by:</strong> {port.sslInfo.issuer?.CN || 'Unknown'}</div>
                                                                        <div><strong>Valid until:</strong> {port.sslInfo.validTo}</div>
                                                                        {port.sslInfo.selfSigned && (
                                                                            <div className="ssl-warning">⚠️ Self-signed certificate</div>
                                                                        )}
                                                                    </div>

                                                                    {port.sslInfo.issues && port.sslInfo.issues.length > 0 && (
                                                                        <div style={{marginTop: '10px'}}>
                                                                            <div style={{fontWeight: '600', color: '#dc2626'}}>SSL Issues:</div>
                                                                            {port.sslInfo.issues.map((issue, idx) => (
                                                                                <div key={idx} style={{color: '#dc2626', fontSize: '0.9rem'}}>
                                                                                    • {issue}
                                                                                </div>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            ) : (
                                                                <div className="ssl-error">
                                                                    ❌ No SSL certificate or connection failed
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}

                                                    {/* Credential Testing Results */}
                                                    {port.credentialTest && (
                                                        <div className="credential-section">
                                                            <div className="credential-title">
                                                                🔑 Default Credential Analysis
                                                            </div>
                                                            
                                                            <div style={{fontSize: '0.9rem', color: '#92400e', marginBottom: '8px'}}>
                                                                Tested {port.credentialTest.testedCredentials} credential combinations
                                                            </div>

                                                            {port.credentialTest.vulnerableCredentials.length > 0 ? (
                                                                <div>
                                                                    <div style={{fontWeight: '600', color: '#dc2626', marginBottom: '8px'}}>
                                                                        🚨 VULNERABLE: Default credentials found!
                                                                    </div>
                                                                    {port.credentialTest.vulnerableCredentials.map((cred, idx) => (
                                                                        <div key={idx} className="credential-vulnerable">
                                                                            <div className="credential-item">
                                                                                {cred.username}:{cred.password} ({cred.service})
                                                                            </div>
                                                                            <div style={{fontSize: '0.8rem', color: '#991b1b', marginTop: '4px'}}>
                                                                                {cred.evidence}
                                                                            </div>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            ) : (
                                                                <div style={{color: '#059669', fontWeight: '600'}}>
                                                                    ✅ No default credentials detected
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* No open ports message */}
                                    {(!selectedDevice.openPorts || selectedDevice.openPorts.length === 0) && (
                                        <div style={{marginTop: '30px'}}>
                                            <h3 className="section-title">Open Ports & Services</h3>
                                            <div style={{
                                                background: '#f0fff4', 
                                                border: '2px solid #9ae6b4', 
                                                borderRadius: '10px', 
                                                padding: '20px', 
                                                textAlign: 'center',
                                                color: '#38a169'
                                            }}>
                                                <div style={{fontSize: '2rem', marginBottom: '10px'}}>🔒</div>
                                                <div style={{fontSize: '1.2rem', fontWeight: '600'}}>No Open Ports Detected</div>
                                                <div style={{marginTop: '5px'}}>This device appears to have no accessible network services, which is good for security.</div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* Security Page */}
                        <div className={`page ${currentPage === 'security' ? 'active' : ''}`}>
                            {/* Export Section for Security */}
                            {networkSecurity && (
                                <div className="export-section">
                                    <div className="export-header">
                                        <div className="export-title">
                                            <span>🛡️</span>
                                            Security Report Export
                                        </div>
                                        <div className="export-buttons">
                                            <button 
                                                className="export-button export-pdf"
                                                onClick={generatePDFReport}
                                            >
                                                📄 Full Security Report
                                            </button>
                                            <button 
                                                className="export-button export-print"
                                                onClick={printReport}
                                            >
                                                🖨️ Print Summary
                                            </button>
                                        </div>
                                    </div>
                                    <div className="export-description">
                                        Generate comprehensive security reports for management or compliance documentation.
                                    </div>
                                </div>
                            )}

                            {/* Data Status Indicator */}
                            {networkSecurity && (
                                <div className="data-status">
                                    <div className="data-status-info">
                                        <div>🛡️</div>
                                        <div>
                                            <strong>Security Analysis:</strong> Based on scan {formatTimestamp(getScanTimestamp())}
                                        </div>
                                    </div>
                                    <button 
                                        className="refresh-button"
                                        onClick={startNewScan}
                                    >
                                        🔄 Update Analysis
                                    </button>
                                </div>
                            )}

                            <div className="security-container">
                                <h2 className="security-title">Network Security Assessment</h2>
                                
                                <div className="security-overview">
                                    <div className="security-score-card">
                                        <div className={`security-score ${networkSecurity ? getSecurityScoreClass(networkSecurity.score) : 'score-critical'}`}>
                                            {networkSecurity ? networkSecurity.score : 0}/100
                                        </div>
                                        <div className="security-status">
                                            {networkSecurity ? getSecurityStatusText(networkSecurity.score) : 'No Data'}
                                        </div>
                                    </div>
                                    
                                    {vulnerabilityStats && (
                                        <div className="stats-grid">
                                            <div className="stat-card">
                                                <div className="stat-number">{vulnerabilityStats.devicesNeedingAttention}</div>
                                                <div className="stat-label">Devices Need Attention</div>
                                            </div>
                                            <div className="stat-card">
                                                <div className="stat-number">{vulnerabilityStats.securityLevels.Critical}</div>
                                                <div className="stat-label">Critical Risks</div>
                                            </div>
                                            <div className="stat-card">
                                                <div className="stat-number">{vulnerabilityStats.averageRiskScore}</div>
                                                <div className="stat-label">Average Risk Score</div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="vulnerability-section">
                                    <div className="vulnerability-grid">
                                        <div className="vulnerability-card">
                                            <h3 className="vulnerability-title">Network Vulnerabilities</h3>
                                            <ul className="vulnerability-list">
                                                {networkSecurity && networkSecurity.recommendations.length > 0 ? (
                                                    networkSecurity.recommendations.map((vuln, index) => (
                                                        <li key={index} className="vulnerability-item">
                                                            {vuln}
                                                        </li>
                                                    ))
                                                ) : (
                                                    <li className="vulnerability-item">
                                                        Run a security scan to identify vulnerabilities
                                                    </li>
                                                )}
                                            </ul>
                                        </div>

                                        <div className="recommendation-card">
                                            <h3 className="vulnerability-title">Security Recommendations</h3>
                                            <ul className="vulnerability-list">
                                                {devices.length > 0 ? (
                                                    devices
                                                        .filter(d => d.security && d.security.recommendations.length > 0)
                                                        .slice(0, 5)
                                                        .map((device, index) => (
                                                            <li key={index} className="recommendation-item">
                                                                <strong>{device.hostname || device.ip}:</strong> {device.security.recommendations[0]}
                                                            </li>
                                                        ))
                                                ) : (
                                                    <li className="recommendation-item">
                                                        Complete a security scan for personalized recommendations
                                                    </li>
                                                )}
                                                
                                                <li className="recommendation-item">
                                                    Regularly update firmware on all network devices
                                                </li>
                                                <li className="recommendation-item">
                                                    Change default passwords on routers and IoT devices
                                                </li>
                                                <li className="recommendation-item">
                                                    Enable WPA3 encryption on wireless networks
                                                </li>
                                                <li className="recommendation-item">
                                                    Implement network segmentation for IoT devices
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DeviceScout />);
    </script>
</body>
</html>